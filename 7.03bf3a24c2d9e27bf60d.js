(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{MnW9:function(e,s,t){"use strict";t.r(s),t.d(s,"MessagingModule",function(){return M});var i=t("3Pt+"),a=t("ofXK"),n=t("tyNb"),o=t("SxV6"),r=t("AytR"),c=t("tB1i"),l=t("y6Nm"),g=t("fXoL"),u=t("J9tS"),b=t("hbwU");function m(e,s){if(1&e&&g.Mb(0,"img",13),2&e){const e=g.bc().$implicit;g.fc("src",e.user.avatar,g.oc)}}function d(e,s){if(1&e&&(g.Mb(0,"div",14),g.cc(1,"safeHtml")),2&e){const e=g.bc().$implicit;g.ec("innerHTML",g.dc(1,1,e.user.svg),g.nc)}}const h=function(e,s){return{online:e,offline:s}};function p(e,s){if(1&e&&(g.Qb(0,"li",8),g.rc(1,m,1,1,"img",9),g.rc(2,d,2,3,"div",10),g.Qb(3,"span",11),g.sc(4),g.Qb(5,"b"),g.sc(6,"Mod\xe9rateur"),g.Pb(),g.Pb(),g.Mb(7,"div",12),g.Pb()),2&e){const e=s.$implicit;g.gc("routerLink","./",e.user.id,""),g.Ab(1),g.ec("ngIf",""!=e.user.avatar),g.Ab(1),g.ec("ngIf",""==e.user.avatar),g.Ab(2),g.uc("",null==e.user?null:e.user.username," "),g.Ab(3),g.ec("ngClass",g.ic(5,h,e.connected,!e.connected))}}function f(e,s){if(1&e&&g.Mb(0,"img",13),2&e){const e=g.bc().$implicit;g.fc("src",e.avatar,g.oc)}}function v(e,s){if(1&e&&(g.Mb(0,"div",14),g.cc(1,"safeHtml")),2&e){const e=g.bc().$implicit;g.ec("innerHTML",g.dc(1,1,e.svg),g.nc)}}function x(e,s){if(1&e&&(g.Qb(0,"li",17),g.rc(1,f,1,1,"img",9),g.rc(2,v,2,3,"div",10),g.Qb(3,"h2"),g.sc(4),g.Qb(5,"span"),g.sc(6,"Mod\xe9rateur"),g.Pb(),g.Pb(),g.Qb(7,"ol"),g.Qb(8,"li",18),g.Qb(9,"div",19),g.sc(10," John Doe "),g.Pb(),g.Pb(),g.Qb(11,"li",18),g.Qb(12,"div",19),g.sc(13," John Doe "),g.Pb(),g.Pb(),g.Pb(),g.Pb()),2&e){const e=s.$implicit;g.gc("routerLink","./",e.id,""),g.Ab(1),g.ec("ngIf",""!=e.avatar),g.Ab(1),g.ec("ngIf",""==e.avatar),g.Ab(2),g.uc("",e.username," ")}}function L(e,s){if(1&e&&(g.Ob(0),g.Qb(1,"div",15),g.Qb(2,"h1"),g.sc(3,"Liste des utilisateurs connect\xe9s"),g.Pb(),g.Qb(4,"ul"),g.rc(5,x,14,4,"li",16),g.Pb(),g.Pb(),g.Nb()),2&e){const e=g.bc();g.Ab(5),g.ec("ngForOf",e.connected_list)}}const w=["chat_box"];function P(e,s){if(1&e&&g.Mb(0,"img",11),2&e){const e=g.bc().$implicit;g.fc("src",e.from_user.avatar,g.oc)}}function k(e,s){if(1&e&&(g.Mb(0,"div",12),g.cc(1,"safeHtml")),2&e){const e=g.bc().$implicit;g.ec("innerHTML",g.dc(1,1,e.from_user.svg),g.nc)}}function _(e,s){if(1&e&&(g.Qb(0,"div",13),g.Qb(1,"span",14),g.sc(2),g.Qb(3,"b"),g.sc(4,"Mod\xe9rateur"),g.Pb(),g.Pb(),g.Qb(5,"span",15),g.sc(6,"Hier \xe0 13:30"),g.Pb(),g.Pb()),2&e){const e=g.bc().$implicit;g.Ab(2),g.tc(e.from_user.username)}}const A=function(e){return{space:e}};function I(e,s){if(1&e&&(g.Qb(0,"li",5),g.Qb(1,"div",6),g.rc(2,P,1,1,"img",7),g.rc(3,k,2,3,"div",8),g.Pb(),g.Qb(4,"div",9),g.rc(5,_,7,1,"div",10),g.Qb(6,"p"),g.sc(7),g.Pb(),g.Pb(),g.Pb()),2&e){const e=s.$implicit;g.ec("ngClass",g.hc(5,A,!e.sameSender)),g.Ab(2),g.ec("ngIf",!e.sameSender&&""!=e.from_user.avatar),g.Ab(1),g.ec("ngIf",!e.sameSender&&""==e.from_user.avatar),g.Ab(2),g.ec("ngIf",!e.sameSender),g.Ab(2),g.uc(" ",e.text," ")}}const Q=[{path:"",component:(()=>{class e{constructor(e,s,t,i,a,n){this.route=e,this.AccountService=s,this.formBuilder=t,this.router=i,this.chat=a,this.FileUploadService=n,this.href="",this.messages=[],this.messagingID=0,this.fetchLast=null,this.connected_list=null,this.AccountService.user.subscribe(e=>this.user=e),this.router.events.subscribe(e=>this.href=e.url),this.chat.getConnectedList()}ngOnInit(){this.chat.fetchLast(this.user.id).pipe(Object(o.a)()).subscribe(e=>{this.fetchLast=e;for(let s=0;s<this.fetchLast.length;s++)this.fetchLast[s].user=this.fetchLast[s].dialog_user1.id!=this.user.id?this.fetchLast[s].dialog_user1:this.fetchLast[s].dialog_user2,this.FileUploadService.getAvatar(this.fetchLast[s].user.id).pipe(Object(o.a)()).subscribe(e=>{const t=Object(c.createAvatar)(l,{seed:this.fetchLast[s].user.username,backgroundColor:"#868889"});""!=e?this.fetchLast[s].user.avatar=r.a.apiUrl+e:(this.fetchLast[s].user.avatar="",this.fetchLast[s].user.svg=t)}),this.fetchLast[s].connected=!1,this.chat.socketConnected(this.fetchLast[s].user.id)}),this.chat.connected.subscribe(e=>{let s=this.fetchLast.findIndex(s=>s.user.id==e.id);-1!=s&&(this.fetchLast[s].connected=e.logged)}),this.chat.connected_list.subscribe(e=>{this.connected_list=e;for(let s=0;s<this.connected_list.length;s++)this.connected_list[s]==this.user.id?this.connected_list.splice(s,1):this.AccountService.getById(this.connected_list[s]).pipe(Object(o.a)()).subscribe(e=>{this.FileUploadService.getAvatar(e.id).pipe(Object(o.a)()).subscribe(s=>{const t=Object(c.createAvatar)(l,{seed:e.username,backgroundColor:"#868889"});""!=s?e.avatar=r.a.apiUrl+s:(e.avatar="",e.svg=t)}),this.connected_list[s]=e})})}ngAfterViewInit(){}}return e.\u0275fac=function(s){return new(s||e)(g.Lb(n.a),g.Lb(u.a),g.Lb(i.b),g.Lb(n.f),g.Lb(u.h),g.Lb(u.c))},e.\u0275cmp=g.Fb({type:e,selectors:[["app-messaging"]],decls:12,vars:2,consts:[[1,"messaging-wrap"],[1,"message-section"],[1,"users"],[1,"search"],["type","text","placeholder","@Un pseudo"],[3,"routerLink",4,"ngFor","ngForOf"],[1,"message-box"],[4,"ngIf"],[3,"routerLink"],["class","avatar",3,"src",4,"ngIf"],["class","avatar avatarSvg",3,"innerHTML",4,"ngIf"],[1,"username"],[1,"statut",3,"ngClass"],[1,"avatar",3,"src"],[1,"avatar","avatarSvg",3,"innerHTML"],[1,"connected-list"],["class","users",3,"routerLink",4,"ngFor","ngForOf"],[1,"users",3,"routerLink"],[1,"characters"],[1,"characterContainer",2,"background-image","url('./assets/img/skin/1/2.png')"]],template:function(e,s){1&e&&(g.Qb(0,"div",0),g.Qb(1,"section",1),g.Qb(2,"div",2),g.Qb(3,"ul"),g.Qb(4,"li",3),g.Qb(5,"form"),g.Mb(6,"input",4),g.Pb(),g.Pb(),g.Pb(),g.Qb(7,"ul"),g.rc(8,p,8,8,"li",5),g.Pb(),g.Pb(),g.Qb(9,"div",6),g.rc(10,L,6,1,"ng-container",7),g.Mb(11,"router-outlet"),g.Pb(),g.Pb(),g.Pb()),2&e&&(g.Ab(8),g.ec("ngForOf",s.fetchLast),g.Ab(2),g.ec("ngIf","/messaging"==s.href))},directives:[i.o,i.g,a.j,a.k,n.j,n.g,a.i],pipes:[b.a],styles:[".messaging-wrap{width:100%}section.message-section{display:grid;grid-template-columns:1fr 4fr;grid-gap:0;height:100vh;width:100%;padding-top:100px}section.message-section .users{background:#202225;box-shadow:inset 0 0 30px 0 #00000080}section.message-section .users ul li{position:relative;display:flex;align-items:center;margin-bottom:5px;cursor:pointer;padding:10px}section.message-section .users ul li.search{background:#9ba1a980;cursor:default}section.message-section .users ul li.search form{width:100%}section.message-section .users ul li img{width:50px;height:50px;border-radius:50%}section.message-section .users ul li .statut{position:absolute;left:45px;bottom:3px;border:5px solid #202225;width:20px;height:20px;border-radius:50%}section.message-section .users ul li .statut.online{background:#38a517}section.message-section .users ul li:hover{background:#9ba1a980}section.message-section .message-box{position:relative;padding:10px;background:#43484e}section.message-section .message-box ol.messages{height:75vh;overflow-x:auto}section.message-section .message-box ol.messages li{display:grid;grid-template-columns:.3fr 6fr;grid-gap:10px;align-items:center}section.message-section .message-box ol.messages li.space:not(:first-child){margin-top:20px}section.message-section .message-box ol.messages li .useravatar{width:50px;height:50px;border-radius:50%}section.message-section .message-box ol.messages li .useravatar svg{border-radius:50%}section.message-section .message-box ol.messages li .msg-content .heading{display:flex;align-items:flex-end;justify-content:space-between}section.message-section .message-box ol.messages li .msg-content .heading span.username{font-size:14px;margin-left:0}section.message-section .message-box ol.messages li .msg-content .heading span.username b{top:0}section.message-section .message-box ol.messages li .msg-content .heading span.time{margin-left:20px;font-size:13px;font-family:Poppins;color:#737a85}section.message-section .message-box ol.messages li .msg-content p{font-family:Poppins}section.message-section .message-box .connected-list{padding:10px;border-radius:4px;box-shadow:inset 0 0 30px 0 #00000080}section.message-section .message-box .connected-list h1{padding:10px;text-transform:uppercase}section.message-section .message-box .connected-list ul li.users{display:inline-flex;align-items:center;justify-content:space-between;width:48%;height:36px;cursor:pointer;background:#202225;margin:5px;padding:5px;overflow:hidden;transition:opacity .3s ease-in-out;box-shadow:inset 0 0 30px 0 #00000080;border-radius:30px}section.message-section .message-box .connected-list ul li.users h2{color:#9ba1a9}section.message-section .message-box .connected-list ul li.users h2 span{font-size:12px}section.message-section .message-box .connected-list ul li.users ol{width:62%}section.message-section .message-box .connected-list ul li.users ol li.characters{position:relative;right:-10px;width:50%;display:inline-block;background-color:#808791;transform:skewX(-20deg)}section.message-section .message-box .connected-list ul li.users ol li.characters .characterContainer{padding:20px;background-position:right -231px top -35px;background-repeat:no-repeat;background-size:550px;transform:skewX(20deg)}section.message-section .message-box .connected-list ul li.users ol li.characters.only{width:100%}section.message-section .message-box .connected-list ul li.users ol li.characters:last-child{background-color:#ed4245}section.message-section .message-box .connected-list ul li.users:hover{opacity:.5}section.message-section .message-box .connected-list ul li.users .avatar{width:30px;border-radius:50%}section.message-section .message-box .connected-list ul li.users .avatar svg{border-radius:50%}section.message-section .message-box form{position:absolute;bottom:0;left:0;width:100%}section.message-section .message-box form textarea{height:100px;border-radius:0}section.message-section span.username{display:inline-block;margin-left:5px;font-family:Montserrat}section.message-section span.username b{display:block;position:relative;top:-5px;text-transform:uppercase;font-family:arial;color:#808791}section.message-section .message-box,section.message-section .users{width:100%;height:100%}"],encapsulation:2}),e})(),children:[{path:":id",component:(()=>{class e{constructor(e,s,t,i,a,n){this.route=e,this.AccountService=s,this.formBuilder=t,this.router=i,this.chat=a,this.FileUploadService=n,this.href="",this.dialog=null,this.beforemessageId=[],this.sameSender=!1}ngOnInit(){this.messagingID=this.route.snapshot.params.id,this.AccountService.user.subscribe(e=>this.user=e),this.href=this.router.url,this.form=this.formBuilder.group({message:["",i.n.required]}),this.chat.getPm(this.messagingID,this.user.id).pipe(Object(o.a)()).subscribe(e=>{this.dialog=e;for(let s=0;s<this.dialog.messages.length;s++){let e=!1;e=this.beforemessageId[this.beforemessageId.length-1]==this.dialog.messages[s].from,this.beforemessageId.push(this.dialog.messages[s].from),this.dialog.messages[s].sameSender=e,this.FileUploadService.getAvatar(this.dialog.messages[s].from_user.id).pipe(Object(o.a)()).subscribe(e=>{const t=Object(c.createAvatar)(l,{seed:this.dialog.messages[s].from_user.username,backgroundColor:"#868889"});""!=e?this.dialog.messages[s].from_user.avatar=r.a.apiUrl+e:(this.dialog.messages[s].from_user.avatar="",this.dialog.messages[s].from_user.svg=t),this.chat_box.nativeElement.scrollTop=this.chat_box.nativeElement.scrollHeight})}}),this.chat.messages.subscribe(e=>{let s=!1;s=this.beforemessageId[this.beforemessageId.length-1]==e.from,this.beforemessageId.push(e.from),e.sameSender=s,this.AccountService.getById(e.from).pipe(Object(o.a)()).subscribe(s=>{this.FileUploadService.getAvatar(s.id).pipe(Object(o.a)()).subscribe(e=>{const t=Object(c.createAvatar)(l,{seed:s.username,backgroundColor:"#868889"});""!=e?s.avatar=r.a.apiUrl+e:(s.avatar="",s.svg=t)}),e.from_user=s}),this.dialog.messages.push(e),this.chat_box.nativeElement.scrollTop=this.chat_box.nativeElement.scrollHeight})}get f(){return this.form.controls}onSubmit(){let e=this.form.get("message").value,s=!1;this.chat.sendMsg({text:e,to:this.messagingID,from:this.user.id}),this.f.message.setValue(""),s=this.dialog.messages[this.dialog.messages.length-1].from_user.id==this.user.id,this.dialog.messages.push({text:e,from_user:this.user,sameSender:s}),setTimeout(()=>{this.chat_box.nativeElement.scrollTop=this.chat_box.nativeElement.scrollHeight},50)}}return e.\u0275fac=function(s){return new(s||e)(g.Lb(n.a),g.Lb(u.a),g.Lb(i.b),g.Lb(n.f),g.Lb(u.h),g.Lb(u.c))},e.\u0275cmp=g.Fb({type:e,selectors:[["app-MessageBox"]],viewQuery:function(e,s){if(1&e&&g.wc(w,1),2&e){let e;g.kc(e=g.Yb())&&(s.chat_box=e.first)}},decls:5,vars:2,consts:[[1,"messages"],["chat_box",""],[3,"ngClass",4,"ngFor","ngForOf"],[3,"formGroup","ngSubmit"],["type","text","placeholder","Envoyer un message","formControlName","message"],[3,"ngClass"],[1,"useravatar"],["class","useravatar",3,"src",4,"ngIf"],["class","useravatar avatarSvg",3,"innerHTML",4,"ngIf"],[1,"msg-content"],["class","heading",4,"ngIf"],[1,"useravatar",3,"src"],[1,"useravatar","avatarSvg",3,"innerHTML"],[1,"heading"],[1,"username"],[1,"time"]],template:function(e,s){1&e&&(g.Qb(0,"ol",0,1),g.rc(2,I,8,7,"li",2),g.Pb(),g.Qb(3,"form",3),g.Xb("ngSubmit",function(){return s.onSubmit()}),g.Mb(4,"input",4),g.Pb()),2&e&&(g.Ab(2),g.ec("ngForOf",null==s.dialog?null:s.dialog.messages),g.Ab(1),g.ec("formGroup",s.form))},directives:[a.j,i.o,i.g,i.d,i.a,i.f,i.c,a.i,a.k],pipes:[b.a],encapsulation:2}),e})()}]}];let y=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=g.Jb({type:e}),e.\u0275inj=g.Ib({imports:[[n.i.forChild(Q)],n.i]}),e})();var S=t("d2mR");let M=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=g.Jb({type:e}),e.\u0275inj=g.Ib({imports:[[a.c,i.l,y,S.a]]}),e})()}}]);